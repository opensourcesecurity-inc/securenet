<?xml version="1.0"?>
<!-- 
  SecureNet OS - WireGuard Excerpt
  Source: OPNsense config.xml <OPNsense><wireguard> section
  Purpose: Verification of published security architecture
  
  This is an excerpt for transparency. It cannot be directly imported.
  See AIW (AI Whitepaper) for complete documentation.
  https://github.com/opensourcesecurity-inc/aiw
  
  REDACTIONS APPLIED:
  - Private keys → [PRIVATE_KEY_REDACTED]
  - Public keys → [PUBLIC_KEY_REDACTED]
  - Preshared keys → [PSK_REDACTED]
  - Endpoint IPs → [ENDPOINT_REDACTED] (domain shown as example)
  - Tunnel IPs → 10.200.0.[X] (structure preserved)
  
  WIREGUARD ARCHITECTURE:
  ======================
  WireGuard provides a modern, high-performance VPN tunnel for SafeNet traffic.
  
  Local Server Configuration:
    - Instance 1 (wg1) named "SafeNet"
    - Listens on port 51822 (non-standard to avoid detection)
    - "Disable routes" enabled - allows policy-based routing instead of
      replacing default gateway (CRITICAL for selective VPN routing)
  
  Peer Configuration:
    - Connects to OSS VPN endpoint (chi.oss-vpn.net)
    - Remote port 51820
    - Allowed IPs: 0.0.0.0/0 (all traffic through tunnel)
    - Keepalive: 25 seconds (maintains NAT traversal)
  
  POLICY ROUTING:
    The "disableroutes" setting is crucial. It prevents WireGuard from
    automatically setting itself as the default gateway. Instead, the
    firewall rules use the SafeNet_GW gateway to selectively route only
    SafeNetPort and SafeNetVLAN traffic through the tunnel.
    
    This allows:
    - Admin networks (LAN1/LAN2) → Direct internet
    - Isolated VLANs → Direct internet
    - SafeNet interfaces → Through VPN tunnel
-->

<wireguard>
  <!-- ============================================== -->
  <!-- WIREGUARD SERVER (LOCAL) CONFIGURATION         -->
  <!-- This defines the local WireGuard interface     -->
  <!-- ============================================== -->
  <server version="1.0.1">
    <servers>
      <server uuid="7355806a-d787-403b-bc34-b000b15bc904">
        <enabled>1</enabled>
        <n>SafeNet</n>
        <!-- Instance number determines interface name (wg1) -->
        <instance>1</instance>
        <!-- Keys auto-generated by OPNsense - REDACTED for security -->
        <pubkey>[PUBLIC_KEY_REDACTED]</pubkey>
        <privkey>[PRIVATE_KEY_REDACTED]</privkey>
        <!-- Non-standard port to reduce fingerprinting -->
        <port>51822</port>
        <mtu/>
        <dns/>
        <!-- Tunnel address assigned by VPN provider -->
        <tunneladdress>10.200.0.[X]/32</tunneladdress>
        <!-- 
          CRITICAL SETTING: disableroutes=1
          This prevents WireGuard from becoming the default gateway.
          Instead, firewall rules use policy-based routing to selectively
          send only SafeNet traffic through the tunnel.
        -->
        <disableroutes>1</disableroutes>
        <gateway/>
        <carp_depend_on/>
        <peers/>
        <debug>0</debug>
        <endpoint/>
        <peer_dns/>
      </server>
    </servers>
  </server>
  
  <!-- ============================================== -->
  <!-- WIREGUARD GENERAL SETTINGS                     -->
  <!-- ============================================== -->
  <general version="0.0.1">
    <enabled>1</enabled>
  </general>
  
  <!-- ============================================== -->
  <!-- WIREGUARD PEER (REMOTE VPN SERVER)             -->
  <!-- This defines the remote VPN endpoint           -->
  <!-- ============================================== -->
  <client version="1.0.0">
    <clients>
      <client uuid="6ea30bb1-04fc-40b5-a678-916385634c70">
        <enabled>1</enabled>
        <n>SafeNet_Server</n>
        <!-- Remote server's public key - REDACTED -->
        <pubkey>[PUBLIC_KEY_REDACTED]</pubkey>
        <!-- Preshared key for additional security layer -->
        <psk>[PSK_REDACTED]</psk>
        <!-- 
          0.0.0.0/0 = Route ALL traffic through this peer
          This is the "Allowed IPs" setting in WireGuard terminology
        -->
        <tunneladdress>0.0.0.0/0</tunneladdress>
        <!-- VPN server endpoint - domain or IP -->
        <serveraddress>[ENDPOINT_REDACTED]</serveraddress>
        <!-- Standard WireGuard port on server side -->
        <serverport>51820</serverport>
        <!-- 
          Keepalive of 25 seconds maintains the tunnel
          through NAT and stateful firewalls
        -->
        <keepalive>25</keepalive>
      </client>
    </clients>
  </client>
</wireguard>
